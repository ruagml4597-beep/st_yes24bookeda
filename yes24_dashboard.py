import streamlit as st
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
import os

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="YES24 ë„ì„œ ë°ì´í„° ëŒ€ì‹œë³´ë“œ", layout="wide")

# ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
@st.cache_data
def load_data():
    file_path = 'yes24_books_cleaned.csv'
    if os.path.exists(file_path):
        df_loaded = pd.read_csv(file_path)
        # ë¬´í•œëŒ€ ê°’(inf)ì„ 0ìœ¼ë¡œ ì²˜ë¦¬ (pd.cut ì˜¤ë¥˜ ë°©ì§€)
        df_loaded = df_loaded.replace([float('inf'), float('-inf')], 0).fillna(0)
        return df_loaded
    else:
        # íŒŒì¼ì´ ì—†ì„ ê²½ìš° ì˜ˆì™¸ ì²˜ë¦¬
        return None

df = load_data()

if df is None:
    st.error("ë°ì´í„° íŒŒì¼('yes24_books_cleaned.csv')ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.")
    st.stop()

# ì‚¬ì´ë“œë°” ë©”ë‰´ êµ¬ì„±
st.sidebar.title("ğŸ“Œ YES24 ë¶„ì„ ë©”ë‰´")
menu = st.sidebar.radio(
    "ì´ë™í•  í˜ì´ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”:",
    ["ëŒ€ì‹œë³´ë“œ í™ˆ", "íŒë§¤ ì§€ìˆ˜ ë¶„ì„", "ì¶œíŒì‚¬ë³„ í†µê³„", "í‚¤ì›Œë“œ íƒìƒ‰ê¸°", "ì›ë³¸ ë°ì´í„° íƒìƒ‰"]
)

# --- 1. Dashboard Home ---
if menu == "ëŒ€ì‹œë³´ë“œ í™ˆ":
    st.title("ğŸ“Š YES24 ë„ì„œ ë°ì´í„° ëŒ€ì‹œë³´ë“œ í™ˆ")
    
    # íƒ­ êµ¬ì„±
    tab1, tab2, tab3 = st.tabs(["ë°ì´í„° ìš”ì•½", "ì¹´í…Œê³ ë¦¬ í˜„í™©", "ì£¼ìš” ì§€í‘œ"])
    
    with tab1:
        st.subheader("ë°ì´í„°ì…‹ ìš”ì•½")
        col1, col2, col3, col4 = st.columns(4)
        col1.metric("ì´ ë„ì„œ ìˆ˜", f"{len(df)}ê¶Œ")
        col2.metric("í‰ê·  í‰ì ", f"{df['í‰ì '].mean():.2f}ì ")
        col3.metric("ìµœê³  íŒë§¤ì§€ìˆ˜", f"{df['íŒë§¤ì§€ìˆ˜_num'].max():,}")
        col4.metric("ì£¼ìš” ì¶œíŒì‚¬ ìˆ˜", f"{df['ì¶œíŒì‚¬'].nunique()}ê°œ")
        
        st.markdown("""
        ì´ ëŒ€ì‹œë³´ë“œëŠ” YES24ì˜ IT/ëª¨ë°”ì¼ ì¹´í…Œê³ ë¦¬ì—ì„œ ìˆ˜ì§‘ëœ ë„ì„œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. 
        ìˆ˜ì§‘ëœ ë°ì´í„°ì—ëŠ” ë„ì„œëª…, ì €ì, ì¶œíŒì‚¬, íŒë§¤ê°€, íŒë§¤ì§€ìˆ˜, í‰ì  ë“± í•µì‹¬ì ì¸ ìƒì—… ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. 
        ì „ì²´ì ì¸ ì‹œì¥ì˜ íë¦„ê³¼ ë…ìë“¤ì˜ ì„ í˜¸ë„ë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ì‹œê°í™” ë„êµ¬ë¥¼ ë°°ì¹˜í•˜ì˜€ìœ¼ë©°, 
        ì‚¬ìš©ìëŠ” ì‚¬ì´ë“œë°”ì˜ ë©”ë‰´ë¥¼ í†µí•´ ìƒì„¸í•œ ë¶„ì„ í˜ì´ì§€ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        í˜„ì¬ ë°ì´í„°ì…‹ì€ ì „ì²˜ë¦¬ ê³¼ì •ì„ ê±°ì³ ë¶„ì„ì— ìµœì í™”ëœ ìƒíƒœì…ë‹ˆë‹¤.
        """)

    with tab2:
        st.subheader("ì¶œíŒ ì›”ë³„ ë“±ë¡ í˜„í™©")
        # ì‹œê°í™” 1: ì›”ë³„ ë¶„í¬
        fig1 = px.histogram(df, x="ì¶œíŒì›”", title="ì›”ë³„ ë„ì„œ ì¶œíŒ íŠ¸ë Œë“œ", color_discrete_sequence=['#636EFA'])
        st.plotly_chart(fig1, use_container_width=True)
        
        st.info("""
        **ë¶„ì„ í¬ì¸íŠ¸:** ìœ„ íˆìŠ¤í† ê·¸ë¨ì€ ë„ì„œë“¤ì´ ì–´ëŠ ì‹œì ì— ì§‘ì¤‘ì ìœ¼ë¡œ ì¶œíŒë˜ì—ˆëŠ”ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. 
        IT ë¶„ì•¼ëŠ” ê¸°ìˆ ì˜ ë°œì „ ì†ë„ê°€ ë§¤ìš° ë¹ ë¥´ê¸° ë•Œë¬¸ì— ìµœì‹  ë„ì„œì˜ ë¹„ì¤‘ì„ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. 
        ì°¨íŠ¸ì—ì„œ íŠ¹ì • ì›”ì— ë§‰ëŒ€ê°€ ë†’ê²Œ ì†Ÿì•„ ìˆë‹¤ë©´ í•´ë‹¹ ê¸°ê°„ì— ì£¼ìš” ê¸°ìˆ  ì„œì ì´ë‚˜ ì‹œë¦¬ì¦ˆë¬¼ì´ ëŒ€ê±° ì¶œê°„ë˜ì—ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. 
        ë°ì´í„° í•´ì„ ì‹œ ì¶œíŒ ì‹œê¸°ì™€ í•¨ê»˜ ë‹¹ì‹œì˜ ê¸°ìˆ  íŠ¸ë Œë“œ(ì˜ˆ: ìƒì„±í˜• AI ë¶)ë¥¼ ê²°í•©í•˜ì—¬ ë¶„ì„í•˜ë©´ ë”ìš± ê¹Šì´ ìˆëŠ” ì¸ì‚¬ì´íŠ¸ë¥¼ ë„ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
        í•˜ë‹¨ì˜ ë°ì´í„°ë¥¼ í†µí•´ ì •í™•í•œ ì›”ë³„ ì¶œê°„ ê¶Œìˆ˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        """)
        
        # êµì°¨í‘œ
        st.write("ì›”ë³„ ì¶œíŒ ê¶Œìˆ˜ ìš”ì•½í‘œ")
        st.dataframe(df['ì¶œíŒì›”'].value_counts().reset_index().rename(columns={'count':'ê¶Œìˆ˜'}))

    with tab3:
        st.subheader("ë¦¬ë·° ìˆ˜ ë¶„í¬")
        # ì‹œê°í™” 2: ë¦¬ë·° ìˆ˜ ë¶„í¬
        fig2 = px.box(df, y="ë¦¬ë·°ìˆ˜", title="ë„ì„œë³„ ë¦¬ë·° ìˆ˜ ë¶„í¬(Box Plot)", points="all")
        st.plotly_chart(fig2, use_container_width=True)
        
        st.info("""
        **ë¶„ì„ í¬ì¸íŠ¸:** ë°•ìŠ¤ í”Œë¡¯ì€ ë°ì´í„°ì˜ ë¶„ì‚°ê³¼ ì´ìƒì¹˜(Outliers)ë¥¼ í•œëˆˆì— íŒŒì•…í•˜ê¸°ì— ìµœì í™”ëœ ë„êµ¬ì…ë‹ˆë‹¤. 
        ìƒë‹¨ì— ì ìœ¼ë¡œ í‘œì‹œëœ ë°ì´í„°ë“¤ì€ í‰ê· ì ì¸ ë¦¬ë·° ìˆ˜ë³´ë‹¤ ì••ë„ì ìœ¼ë¡œ ë§ì€ ë°˜ì‘ì„ ëŒì–´ë‚¸ 'ìŠˆí¼ ë² ìŠ¤íŠ¸ì…€ëŸ¬'ì„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. 
        ëŒ€ë¶€ë¶„ì˜ ë„ì„œê°€ ë°•ìŠ¤ê¶Œ(ì¤‘ì•™ê°’ ì£¼ë³€)ì— ë¨¸ë¬¼ëŸ¬ ìˆëŠ” ë°˜ë©´, íŠ¹ì • ë„ì„œë“¤ì´ ì°¨íŠ¸ ìƒë‹¨ì— ìœ„ì¹˜í•˜ëŠ” ê²ƒì€ ë…ì ì†Œí†µì˜ ë¶ˆê· í˜•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. 
        ì´ëŸ¬í•œ ë°ì´í„° ë¶„ì„ì„ í†µí•´ ì–´ë–¤ ë„ì„œë“¤ì´ ê°•ë ¥í•œ íŒ¬ë¤ì„ í˜•ì„±í•˜ê³  ìˆëŠ”ì§€, í˜¹ì€ ë§ˆì¼€íŒ… íš¨ê³¼ê°€ ê·¹ëŒ€í™”ë˜ì—ˆëŠ”ì§€ ì¶”ë¡ í•  ìˆ˜ ìˆëŠ” ê·¼ê±°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
        """)
        
        # í”¼ë²— í…Œì´ë¸”
        st.write("í‰ì ë³„ í‰ê·  ë¦¬ë·° ìˆ˜")
        pivot_rating = df.groupby('í‰ì ')['ë¦¬ë·°ìˆ˜'].agg(['mean', 'count']).reset_index()
        st.table(pivot_rating.head(10))

# --- 2. Sales Insights ---
elif menu == "íŒë§¤ ì§€ìˆ˜ ë¶„ì„":
    st.title("ğŸ“ˆ íŒë§¤ì§€ìˆ˜ ë° ê°€ê²© ì „ëµ ë¶„ì„")
    
    # íŒë§¤ì§€ìˆ˜ í•„í„°
    max_idx = int(df['íŒë§¤ì§€ìˆ˜_num'].max())
    idx_range = st.sidebar.slider("íŒë§¤ì§€ìˆ˜ ë²”ìœ„ ì„ íƒ", 0, max_idx, (0, max_idx))
    filtered_df = df[(df['íŒë§¤ì§€ìˆ˜_num'] >= idx_range[0]) & (df['íŒë§¤ì§€ìˆ˜_num'] <= idx_range[1])]

    tab1, tab2, tab3 = st.tabs(["ê°€ê²© ìƒê´€ê´€ê³„", "íŒë§¤ì§€ìˆ˜ íˆìŠ¤í† ê·¸ë¨", "ìƒìœ„ íŒë§¤ ë„ì„œ"])

    with tab1:
        st.subheader("íŒë§¤ê°€ì™€ íŒë§¤ì§€ìˆ˜ ê°„ì˜ ìƒê´€ê´€ê³„")
        fig3 = px.scatter(filtered_df, x="íŒë§¤ê°€_num", y="íŒë§¤ì§€ìˆ˜_num", color="í‰ì ", 
                         hover_data=["ì œëª©", "ì¶œíŒì‚¬"], title="ê°€ê²© ëŒ€ë¹„ ì¸ê¸°ë„ ë¶„ì„")
        st.plotly_chart(fig3, use_container_width=True)
        
        st.success("""
        **ë°ì´í„° ì„¤ëª…:** ì´ ì‚°ì ë„ëŠ” ë„ì„œì˜ 'ê°€ê²©'ì´ 'íŒë§¤ëŸ‰(íŒë§¤ì§€ìˆ˜)'ì— ë¯¸ì¹˜ëŠ” ì •ëŸ‰ì ì¸ ì˜í–¥ì„ ë¶„ì„í•˜ê¸° ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. 
        ê°€ë¡œì¶•ì€ ì‹¤ì œ êµ¬ë§¤ ê°€ê²©ì„, ì„¸ë¡œì¶•ì€ ì¸ê¸°ë„ ì§€í‘œì¸ íŒë§¤ì§€ìˆ˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. 
        ìƒ‰ìƒì€ í‰ì ì„ ì˜ë¯¸í•˜ë©°, ì´ë¥¼ í†µí•´ ê³ ê°€ ë„ì„œì„ì—ë„ ë§Œì¡±ë„ê°€ ë†’ì€ì§€, í˜¹ì€ ì €ê°€ ë„ì„œê°€ íŒë§¤ëŸ‰ì´ ì••ë„ì ì¸ì§€ ì‹œê°ì ìœ¼ë¡œ ëŒ€ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
        ìƒê´€ê´€ê³„ê°€ ëšœë ·í•˜ë‹¤ë©´ ëŒ€ê°ì„  ë°©í–¥ìœ¼ë¡œ ì ë“¤ì´ ì •ë ¬ë˜ê² ì§€ë§Œ, í˜„ì¬ ë¶„í¬ë¥¼ ë³´ë©´ ê°€ê²©ë³´ë‹¤ëŠ” ì½˜í…ì¸ ì˜ ì§ˆì´ë‚˜ ì£¼ì œê°€ íŒë§¤ì— ë” í° ì˜í–¥ì„ ë¯¸ì¹˜ê³  ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
        ë§ˆì¼€íŒ… ì „ëµ ìˆ˜ë¦½ ì‹œ ê²½ìŸ ë„ì„œì˜ ê°€ê²©ëŒ€ì™€ ì¸ê¸°ë„ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ëŠ” ì „ëµì  ìì‚°ì´ ë©ë‹ˆë‹¤.
        """)
        
        # êµì°¨í‘œ
        st.write("ê°€ê²©ëŒ€ë³„ í‰ê·  íŒë§¤ì§€ìˆ˜")
        filtered_df['ê°€ê²©ëŒ€'] = (filtered_df['íŒë§¤ê°€_num'] // 10000) * 10000
        price_pivot = filtered_df.groupby('ê°€ê²©ëŒ€')['íŒë§¤ì§€ìˆ˜_num'].mean().reset_index()
        st.dataframe(price_pivot)

    with tab2:
        st.subheader("íŒë§¤ì§€ìˆ˜ ë°€ë„ ë¶„ì„")
        fig4 = px.violin(filtered_df, y="íŒë§¤ì§€ìˆ˜_num", box=True, points="all", title="íŒë§¤ì§€ìˆ˜ ë¶„í¬ ë°€ë„")
        st.plotly_chart(fig4, use_container_width=True)
        
        st.warning("""
        **ë°ì´í„° ì„¤ëª…:** ë°”ì´ì˜¬ë¦° í”Œë¡¯ì€ íˆìŠ¤í† ê·¸ë¨ê³¼ ë°•ìŠ¤ í”Œë¡¯ì˜ ì¥ì ì„ ê²°í•©í•˜ì—¬ ë°ì´í„°ì˜ ë°€ì§‘ë„ë¥¼ ê³¡ì„  í˜•íƒœë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤. 
        ì¤‘ì•™ì˜ ë‘êº¼ìš´ ë¶€ë¶„ì€ ê°€ì¥ ë§ì€ ë„ì„œê°€ ìœ„ì¹˜í•œ íŒë§¤ì§€ìˆ˜ êµ¬ê°„ì„ ì˜ë¯¸í•˜ë©°, ê¸¸ê²Œ ë»—ì€ ìœ„ìª½ ê¼¬ë¦¬ëŠ” ì†Œìˆ˜ì˜ ë² ìŠ¤íŠ¸ì…€ëŸ¬ê°€ ì‹œì¥ì„ ê²¬ì¸í•˜ê³  ìˆìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤. 
        ì´ ì°¨íŠ¸ëŠ” ì‹œì¥ì˜ ê°€ì—´ ì •ë„ë¥¼ íŒŒì•…í•˜ëŠ” ë° íš¨ê³¼ì ì…ë‹ˆë‹¤. 
        ë§Œì•½ í•˜ë‹¨ë¶€ì—ë§Œ ë°€ì§‘ë˜ì–´ ìˆë‹¤ë©´ ëŒ€ë‹¤ìˆ˜ì˜ ë„ì„œê°€ ì‹ ê·œ ì§„ì…ì— ì–´ë ¤ì›€ì„ ê²ªê³  ìˆë‹¤ëŠ” ì‹ í˜¸ì¼ ìˆ˜ ìˆìœ¼ë©°, 
        ë„“ê²Œ í¼ì ¸ ìˆë‹¤ë©´ ë‹¤ì–‘í•œ ë„ì„œê°€ ê³ ë¥´ê²Œ ì‚¬ë‘ë°›ê³  ìˆëŠ” ê±´ê°•í•œ ìƒíƒœê³„ì„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. 
        í˜„ì¬ IT ë„ì„œ ì‹œì¥ì˜ íŒŒë ˆí†  ë²•ì¹™(8:2 ë²•ì¹™) ì ìš© ì—¬ë¶€ë¥¼ í™•ì¸í•´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.
        """)
        
        # í”¼ë²—
        st.write("ì¶œíŒì‚¬ë³„ íŒë§¤ì§€ìˆ˜ í•©ê³„")
        pub_sales = filtered_df.groupby('ì¶œíŒì‚¬')['íŒë§¤ì§€ìˆ˜_num'].sum().sort_values(ascending=False).head(10).reset_index()
        st.table(pub_sales)

    with tab3:
        st.subheader("ì„ íƒ ë²”ìœ„ ë‚´ ìƒìœ„ íŒë§¤ ë„ì„œ Top 10")
        top_10 = filtered_df.sort_values('íŒë§¤ì§€ìˆ˜_num', ascending=False).head(10)
        st.table(top_10[['ì œëª©', 'ì €ì', 'ì¶œíŒì‚¬', 'íŒë§¤ì§€ìˆ˜_num', 'íŒë§¤ê°€']])
        
        st.write("ìƒìœ„ ë„ì„œ ìƒì„¸ ì§€í‘œ êµì°¨ë¶„ì„")
        st.dataframe(top_10.pivot_table(index='ì¶œíŒì‚¬', values=['íŒë§¤ì§€ìˆ˜_num', 'ë¦¬ë·°ìˆ˜'], aggfunc='mean'))

# --- 3. Publisher Stats ---
elif menu == "ì¶œíŒì‚¬ë³„ í†µê³„":
    st.title("ğŸ¢ ì¶œíŒì‚¬ë³„ ë§ˆì¼“ ë°ì´í„°")
    
    # ì¶œíŒì‚¬ ì„ íƒ ë©€í‹°ì…€ë ‰íŠ¸
    pubs = st.sidebar.multiselect("ë¶„ì„í•  ì¶œíŒì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš”", options=sorted(df['ì¶œíŒì‚¬'].unique()), default=df['ì¶œíŒì‚¬'].value_counts().head(5).index.tolist())
    pub_df = df[df['ì¶œíŒì‚¬'].isin(pubs)]

    tab1, tab2, tab3 = st.tabs(["ì¶œíŒ ê·œëª¨ ë¹„êµ", "ì¶œíŒì‚¬ë³„ í‰ì ", "í• ì¸ ì •ì±…"])

    with tab1:
        st.subheader("ì¶œíŒì‚¬ë³„ ë„ì„œ ë°œí–‰ëŸ‰")
        fig5 = px.pie(pub_df, names="ì¶œíŒì‚¬", title="ì„ íƒëœ ì¶œíŒì‚¬ë“¤ì˜ ë„ì„œ ë¹„ì¤‘")
        st.plotly_chart(fig5, use_container_width=True)
        
        st.info("""
        **í•´ì„ ë¬¸êµ¬:** ì´ íŒŒì´ ì°¨íŠ¸ëŠ” ì‹œì¥ ë‚´ì—ì„œ íŠ¹ì • ì¶œíŒì‚¬ê°€ ì°¨ì§€í•˜ëŠ” ë„ì„œ ë°œí–‰ ê¶Œìˆ˜ì˜ ë¹„ì¤‘ì„ ì‹œê°í™”í•©ë‹ˆë‹¤. 
        IT ê¸°ìˆ ì„œ ì‹œì¥ì—ì„œ ì–´ë–¤ ë¸Œëœë“œê°€ ê°€ì¥ ê³µê²©ì ìœ¼ë¡œ ì‹ ê°„ì„ ë°œë§¤í•˜ê³  ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì§€í‘œì…ë‹ˆë‹¤. 
        ë¹„ì¤‘ì´ í¬ë‹¤ëŠ” ê²ƒì€ ê·¸ë§Œí¼ ë‹¤ì–‘í•œ ë¼ì¸ì—…ì„ í™•ë³´í•˜ê³  ìˆë‹¤ëŠ” ë°©ì¦ì´ë©°, ë…ìë“¤ì—ê²ŒëŠ” ë¸Œëœë“œ ì¸ì§€ë„ê°€ ë†’ê²Œ í˜•ì„±ë  ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. 
        í•˜ì§€ë§Œ ì–‘ì ì¸ ê³µì„¸ê°€ ë°˜ë“œì‹œ ë†’ì€ íŒë§¤ë¡œ ì´ì–´ì§€ëŠ”ì§€ëŠ” íŒë§¤ì§€ìˆ˜ ë°ì´í„°ì™€ êµì°¨ ê²€ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤. 
        í•˜ë‹¨ì˜ í…Œì´ë¸”ì€ ê° ì¶œíŒì‚¬ê°€ ë³´ìœ í•œ ë„ì„œì˜ ì´ íŒë§¤ì§€ìˆ˜ í•©ì„ ë³´ì—¬ì£¼ì–´, ì–‘ê³¼ ì§ˆì˜ ìƒê´€ê´€ê³„ë¥¼ ëª…í™•íˆ ì„¤ëª…í•´ì¤ë‹ˆë‹¤.
        """)
        
        # êµì°¨í‘œ
        st.write("ì¶œíŒì‚¬ë³„ ë°œí–‰ ê¶Œìˆ˜ ë° ì´ íŒë§¤ì§€ìˆ˜")
        pub_summary = pub_df.groupby('ì¶œíŒì‚¬').agg({'ì œëª©':'count', 'íŒë§¤ì§€ìˆ˜_num':'sum'}).rename(columns={'ì œëª©':'ê¶Œìˆ˜', 'íŒë§¤ì§€ìˆ˜_num':'ì´íŒë§¤ì§€ìˆ˜'})
        st.dataframe(pub_summary)

    with tab2:
        st.subheader("ì¶œíŒì‚¬ë³„ í‰ê·  í‰ì  í˜„í™©")
        fig6 = px.bar(pub_df.groupby('ì¶œíŒì‚¬')['í‰ì '].mean().reset_index(), x="ì¶œíŒì‚¬", y="í‰ì ", 
                     title="ì¶œíŒì‚¬ë³„ ë…ì ë§Œì¡±ë„ ë¹„êµ", color="í‰ì ", color_continuous_scale="Viridis")
        st.plotly_chart(fig6, use_container_width=True)
        
        st.success("""
        **í•´ì„ ë¬¸êµ¬:** ë„ì„œì˜ ì§ˆì  ì¸¡ë©´ì„ í‰ê°€í•  ë•Œ ê°€ì¥ ì‹ ë¢°í•  ë§Œí•œ ë°ì´í„°ëŠ” ë…ìë“¤ì´ ì§ì ‘ ë‚¨ê¸´ í‰ì ì…ë‹ˆë‹¤. 
        ìœ„ ì°¨íŠ¸ëŠ” ì„ íƒëœ ì¶œíŒì‚¬ë³„ë¡œ ë°œí–‰ëœ ë„ì„œë“¤ì˜ í‰ê·  í‰ì ì„ ë¹„êµí•˜ì—¬, ì–´ë–¤ ì¶œíŒì‚¬ì˜ ë„ì„œê°€ ë…ìë“¤ì—ê²Œ ê°€ì¥ í° ì‹ ë¢°ë¥¼ ë°›ê³  ìˆëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤. 
        IT ì „ë¬¸ ì„œì ì€ ì˜¤íƒ€ë‚˜ ì„¤ëª…ì˜ ì˜¤ë¥˜ì— ë¯¼ê°í•˜ê¸° ë•Œë¬¸ì— í‰ì ì´ ë¸Œëœë“œ ì‹ ë¢°ë„ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì´ ë§¤ìš° í½ë‹ˆë‹¤. 
        ì°¨íŠ¸ì—ì„œ ë†’ì€ ì ìˆ˜ë¥¼ ìœ ì§€í•˜ëŠ” ì¶œíŒì‚¬ëŠ” ê²€ìˆ˜ ì‹œìŠ¤í…œì´ ì˜ ê°–ì¶°ì ¸ ìˆê±°ë‚˜ ìœ ëª… ì €ìë“¤ì„ í™•ë³´í•˜ê³  ìˆì„ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤. 
        ë‹¨ìˆœ íŒë§¤ëŸ‰ê³¼ í‰ì ì„ ë¹„êµí•´ë´„ìœ¼ë¡œì¨ 'ë§ì´ íŒ”ë¦¬ë©´ì„œë„ ìš•ì„ ë¨¹ëŠ” ì±…'ê³¼ 'ì ê²Œ íŒ”ë¦¬ì§€ë§Œ ë§¤ë‹ˆì•„ì¸µì´ ê²¬ê³ í•œ ì±…'ì„ êµ¬ë¶„í•´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        """)
        
        # í”¼ë²— í…Œì´ë¸”
        st.write("ì¶œíŒì‚¬ë³„ í‰ì  êµ¬ê°„ ë¹ˆë„")
        pub_df['í‰ì êµ¬ê°„'] = pd.cut(pub_df['í‰ì '], bins=[0, 8, 9, 10], labels=['8ì ë¯¸ë§Œ', '8~9ì ', '9~10ì '])
        rating_pivot = pd.crosstab(pub_df['ì¶œíŒì‚¬'], pub_df['í‰ì êµ¬ê°„'])
        st.table(rating_pivot)

    with tab3:
        st.subheader("ì¶œíŒì‚¬ë³„ í• ì¸ ì •ì±… ë¶„ì„")
        fig7 = px.box(pub_df, x="ì¶œíŒì‚¬", y="í• ì¸ìœ¨", title="ì¶œíŒì‚¬ë³„ ë„ì„œ í• ì¸ìœ¨ ë¶„í¬")
        st.plotly_chart(fig7, use_container_width=True)
        
        st.write("ì¶œíŒì‚¬/í• ì¸ìœ¨ë³„ ë„ì„œ ìˆ˜ ìš”ì•½")
        st.dataframe(pd.crosstab(pub_df['ì¶œíŒì‚¬'], pd.cut(pub_df['í• ì¸ìœ¨'], bins=5)))

# --- 4. Keyword Explorer ---
elif menu == "í‚¤ì›Œë“œ íƒìƒ‰ê¸°":
    st.title("ğŸ” í‚¤ì›Œë“œ ê¸°ë°˜ ìƒì„¸ ë„ì„œ íƒìƒ‰")
    
    keyword = st.text_input("ê²€ìƒ‰í•  í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: AI, íŒŒì´ì¬, ë”¥ëŸ¬ë‹)", "AI")
    k_df = df[df['ì œëª©'].str.contains(keyword, case=False, na=False)]

    if k_df.empty:
        st.warning(f"'{keyword}'ì— í•´ë‹¹í•˜ëŠ” ë„ì„œê°€ ì—†ìŠµë‹ˆë‹¤.")
    else:
        tab1, tab2, tab3 = st.tabs(["í‚¤ì›Œë“œ í†µê³„", "ë¦¬ë·° í˜„í™©", "í‚¤ì›Œë“œ ë„ì„œ ëª©ë¡"])
        
        with tab1:
            st.subheader(f"'{keyword}' í‚¤ì›Œë“œ í¬í•¨ ë„ì„œ ê·œëª¨")
            fig8 = px.scatter(k_df, x="íŒë§¤ê°€_num", y="í‰ì ", size="íŒë§¤ì§€ìˆ˜_num", color="ì¶œíŒì‚¬",
                             hover_data=["ì œëª©"], title=f"í‚¤ì›Œë“œ '{keyword}' ë¶„ì„ (ë²„ë¸”ì˜ í¬ê¸°ëŠ” íŒë§¤ì§€ìˆ˜)")
            st.plotly_chart(fig8, use_container_width=True)
            
            st.info("""
            **ë°ì´í„° ì„¤ëª…:** ë²„ë¸” ì°¨íŠ¸ë¥¼ í†µí•´ í‚¤ì›Œë“œ ê²€ìƒ‰ ê²°ê³¼ì˜ íŠ¹ì„±ì„ ë‹¤ê°ë„ë¡œ ë¶„ì„í•©ë‹ˆë‹¤. 
            ë²„ë¸”ì˜ ìœ„ì¹˜ëŠ” ê°€ê²©ê³¼ í‰ì ì„ ë‚˜íƒ€ë‚´ë©°, í¬ê¸°ëŠ” íŒë§¤ì§€ìˆ˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. 
            ì˜ˆë¥¼ ë“¤ì–´ ì°¨íŠ¸ ìš°ìƒë‹¨ì— ìœ„ì¹˜í•œ í° ë²„ë¸”ì€ 'ê°€ê²©ì´ ë†’ìŒì—ë„ ë¶ˆêµ¬í•˜ê³  í‰ì ì´ ì¢‹ê³  íŒë§¤ëŸ‰ë„ ë§ì€ ì£¼ë¥˜ ë„ì„œ'ì„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. 
            ì‚¬ìš©ìëŠ” íŠ¹ì • í‚¤ì›Œë“œ ì‹œì¥ì—ì„œ ì–´ë–¤ ê°€ê²©ëŒ€ì˜ ë„ì„œê°€ ì†Œë¹„ìë“¤ì—ê²Œ ê°€ì¥ ì˜ ë¨¹íˆëŠ”ì§€, 
            ì–´ë–¤ ì¶œíŒì‚¬ê°€ í•´ë‹¹ í‚¤ì›Œë“œ ì˜ì—­ì—ì„œ ê°•ë ¥í•œ íŒ¬ë¤ì„ í˜•ì„±í•˜ê³  ìˆëŠ”ì§€ ì§ê´€ì ìœ¼ë¡œ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
            ë°ì´í„° ì‹œê°í™” í•˜ë‹¨ì˜ í…Œì´ë¸”ì„ í†µí•´ êµ¬ì²´ì ì¸ ìˆ˜ì¹˜ë¥¼ í™•ì¸í•˜ë©° ë¶„ì„ì˜ ì •í•©ì„±ì„ ë†’ì—¬ë³´ì„¸ìš”.
            """)
            
            # êµì°¨í‘œ
            st.write("í‚¤ì›Œë“œ ë„ì„œ ì¶œíŒì‚¬ë³„ ìš”ì•½")
            k_summary = k_df.groupby('ì¶œíŒì‚¬').agg({'ì œëª©':'count', 'íŒë§¤ì§€ìˆ˜_num':'mean', 'í‰ì ':'mean'}).head(10)
            st.dataframe(k_summary)

        with tab2:
            st.subheader("í‰ì  ëŒ€ë¹„ ë¦¬ë·° ìˆ˜ ë¶„ì„")
            fig9 = px.strip(k_df, x="í‰ì ", y="ë¦¬ë·°ìˆ˜", color="ì¶œíŒì‚¬", title=f"'{keyword}' ë„ì„œ í‰ì ë³„ ë¦¬ë·° í˜„í™©")
            st.plotly_chart(fig9, use_container_width=True)
            
            st.success("""
            **ë°ì´í„° ì„¤ëª…:** ì´ ìŠ¤íŠ¸ë¦½ ì°¨íŠ¸ëŠ” í‰ì ê³¼ ë¦¬ë·° ìˆ˜ ì‚¬ì´ì˜ ë°€ì§‘ë„ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. 
            ë„ì„œì˜ ì œëª©ì— '{0}' í‚¤ì›Œë“œê°€ ë“¤ì–´ê°„ ë„ì„œë“¤ì´ ì–¼ë§ˆë‚˜ í™œë°œí•˜ê²Œ ë…ìë“¤ì˜ í”¼ë“œë°±ì„ ë°›ê³  ìˆëŠ”ì§€ ë³´ì—¬ì£¼ëŠ” ì§€í‘œì…ë‹ˆë‹¤. 
            ë¦¬ë·°ê°€ íŠ¹ì • ì ìˆ˜ëŒ€ì— ë­‰ì³ ìˆë‹¤ë©´ í•´ë‹¹ í‚¤ì›Œë“œì˜ ë„ì„œë“¤ì´ ìƒí–¥ í‰ì¤€í™”ë˜ì–´ ìˆê±°ë‚˜ ìœ ì‚¬í•œ í‰ê°€ë¥¼ ë°›ê³  ìˆìŒì„ ì‹œì‚¬í•©ë‹ˆë‹¤. 
            ë°˜ë©´ ë„“ê²Œ í¼ì ¸ ìˆë‹¤ë©´ ì €ìë‚˜ ì¶œíŒì‚¬ì— ë”°ë¼ ë…ìì˜ ê²½í—˜ì´ ê·¹ëª…í•˜ê²Œ ê°ˆë¦¬ëŠ” ê¸°ìˆ  ë¶„ì•¼ì„ì„ ì¶”ì¸¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
            ì¸ê¸° í‚¤ì›Œë“œì¼ìˆ˜ë¡ ë¦¬ë·°ì˜ ë¹ˆë„ê°€ ë†’ì•„ì§€ëŠ” ê²½í–¥ì´ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ í˜„ì¬ IT íŠ¸ë Œë“œ ë‚´ì—ì„œ ì†Œë¹„ìë“¤ì˜ ì‹¤ì§ˆì ì¸ ê´€ì‹¬ë„ë¥¼ ê°€ëŠ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
            í•˜ë‹¨ì˜ í”¼ë²— í…Œì´ë¸”ì€ í‰ì  êµ¬ê°„ë³„ ì´ ë¦¬ë·° ë¶„í¬ë¥¼ ìˆ˜ì¹˜ë¡œ í™˜ì‚°í•˜ì—¬ ì œê³µí•©ë‹ˆë‹¤.
            """.format(keyword))
            
            # í”¼ë²—
            st.write("í‰ì ë³„ ì´ ë¦¬ë·° ìˆ˜ í•©ê³„")
            k_pivot = k_df.groupby('í‰ì ')['ë¦¬ë·°ìˆ˜'].sum().reset_index()
            st.table(k_pivot)
            
        with tab3:
            st.subheader(f"'{keyword}' ê´€ë ¨ ë„ì„œ ë°ì´í„° í…Œì´ë¸”")
            st.dataframe(k_df[['ì œëª©', 'ì €ì', 'ì¶œíŒì‚¬', 'íŒë§¤ì§€ìˆ˜_num', 'í‰ì ', 'ë¦¬ë·°ìˆ˜']])

# --- 5. Raw Data Explorer ---
elif menu == "ì›ë³¸ ë°ì´í„° íƒìƒ‰":
    st.title("ğŸ“‹ ì „ì²´ ë„ì„œ ë°ì´í„° íƒìƒ‰")
    
    st.markdown("""
    ì´ í˜ì´ì§€ì—ì„œëŠ” ìˆ˜ì§‘ ë° ì •ì œëœ ì „ì²´ ë°ì´í„°ë¥¼ ììœ ë¡­ê²Œ íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
    ìƒë‹¨ì˜ í•„í„° ì˜µì…˜ì„ ì‚¬ìš©í•´ ì›í•˜ëŠ” ì¡°ê±´ì˜ ë„ì„œë¥¼ ê²€ìƒ‰í•˜ê³  ìì‚°ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” CSV íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ í•˜ì„¸ìš”. 
    ë°ì´í„° ì „ì²˜ë¦¬ë¥¼ í†µí•´ ìˆ«ìí˜• ë°ì´í„°(`_num` ì ‘ë¯¸ì‚¬)ì™€ ë‚ ì§œ ë°ì´í„°(`ì¶œíŒì›”`)ê°€ ì¶”ê°€ë˜ì–´ ìˆì–´ ë¶„ì„ì— ìš©ì´í•©ë‹ˆë‹¤.
    """)
    
    tab1, tab2, tab3 = st.tabs(["ë°ì´í„° í…Œì´ë¸”", "ì»¬ëŸ¼ ì •ë³´", "ë‚´ë³´ë‚´ê¸°"])
    
    with tab1:
        # í•„í„°ë§ ê¸°ëŠ¥
        search_term = st.text_input("ì œëª©ìœ¼ë¡œ ê²€ìƒ‰", "")
        display_df = df[df['ì œëª©'].str.contains(search_term, na=False)]
        st.dataframe(display_df, use_container_width=True)
        
    with tab2:
        st.write("ë„ì„œ ë°ì´í„° í•„ë“œ ì„¤ëª…")
        cols_info = pd.DataFrame({
            "ì»¬ëŸ¼ëª…": df.columns,
            "ì„¤ëª…": ["ë„ì„œ ì œëª©", "ì €ì ì •ë³´", "ì¶œíŒì‚¬ëª…", "ìˆ˜ì§‘ëœ ì¶œíŒì¼", "ìˆ˜ì§‘ëœ íŒë§¤ê°€", "ìˆ˜ì§‘ëœ ì •ê°€", "ìˆ˜ì§‘ëœ íŒë§¤ì§€ìˆ˜", "ë¦¬ë·° ê°œìˆ˜", "í‰ì  (0~10)", "ì •ì œëœ íŒë§¤ê°€(ìˆ«ì)", "ì •ì œëœ ì •ê°€(ìˆ«ì)", "ì •ì œëœ íŒë§¤ì§€ìˆ˜(ìˆ«ì)", "ì •ì œëœ ì¶œíŒì›”(YYYY-MM)", "ê³„ì‚°ëœ í• ì¸ìœ¨(%)"]
        })
        st.table(cols_info)
        
    with tab3:
        st.subheader("ë°ì´í„° ë‹¤ìš´ë¡œë“œ")
        csv = df.to_csv(index=False).encode('utf-8-sig')
        st.download_button(
            label="ì •ì œëœ ë°ì´í„° CSVë¡œ ì €ì¥",
            data=csv,
            file_name='yes24_books_cleaned_export.csv',
            mime='text/csv',
        )

# í•˜ë‹¨ ì •ë³´
st.sidebar.markdown("---")
st.sidebar.info("Data source: YES24 Category Search\nLast updated: 2025-12-29")
